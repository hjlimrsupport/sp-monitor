<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Splashtop JP í†µí•© ëª¨ë‹ˆí„°ë§ ì„¼í„°</title>
    <!-- ê³ ê¸‰ í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0055ff;
            --primary-light: #e6f0ff;
            --bg: #f8fafc;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --border: #e2e8f0;
            --card-bg: #ffffff;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
        }

        .title-group h1 {
            font-size: 2rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.02em;
        }

        .title-group p {
            color: var(--text-sub);
            margin: 0.2rem 0 0 0;
        }

        .btn-help {
            background: white;
            border: 1px solid var(--border);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-sub);
            transition: all 0.2s;
        }

        .btn-help:hover {
            background: var(--border);
        }

        /* Action Buttons */
        .action-bar {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            transition: transform 0.1s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-danger {
            background: #fee2e2;
            color: var(--danger);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-sub);
            font-weight: 600;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            margin-top: 0.3rem;
            display: block;
        }

        .stat-delta {
            font-size: 0.85rem;
            font-weight: 700;
            margin-top: 0.2rem;
        }

        .delta-plus {
            color: var(--success);
        }

        .delta-minus {
            color: var(--danger);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1.5rem;
            border-bottom: 2px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.8rem 0.2rem;
            font-weight: 700;
            color: var(--text-sub);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Report List */
        .report-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 0.8rem;
            overflow: hidden;
        }

        .item-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .item-header:hover {
            background: #fafafa;
        }

        .badge {
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            margin-right: 0.8rem;
        }

        .badge-new {
            background: #dcfce7;
            color: #166534;
        }

        .badge-changed {
            background: #fef9c3;
            color: #854d0e;
        }

        .badge-deleted {
            background: #fee2e2;
            color: #991b1b;
        }

        .item-title {
            font-weight: 700;
            flex-grow: 1;
        }

        .item-content {
            padding: 1rem;
            border-top: 1px solid var(--border);
            background: #fcfcfc;
            display: none;
        }

        .url-link {
            color: var(--primary);
            font-size: 0.9rem;
            word-break: break-all;
            text-decoration: none;
        }

        .item-desc {
            margin-top: 0.5rem;
            font-size: 0.95rem;
            color: var(--text-main);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--primary-light);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .chart-container {
            height: 300px;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border);
        }
    </style>
</head>

<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; font-weight: 700;">ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
    </div>

    <div class="container">
        <header>
            <div class="title-group">
                <h1>Splashtop JP í†µí•© ëª¨ë‹ˆí„°ë§</h1>
                <p>ì‚¬ì´íŠ¸ë§µ ì°¨ë¶„ ì¡°ì‚¬ë¥¼ í†µí•œ ì‹ ì†í•œ ë³€í™” ê°ì§€ ì„œë¹„ìŠ¤</p>
            </div>
            <button class="btn-help" onclick="toggleModal('help-modal', true)">â“ ë„ì›€ë§</button>
        </header>

        <section class="action-bar">
            <button class="btn btn-primary" onclick="runScan()">ğŸš€ ì‚¬ì´íŠ¸ ë¶„ì„ ì‹¤í–‰ (Run Scan)</button>
            <button class="btn btn-outline" onclick="runCleanup()">ğŸ§¹ ë°ì´í„° ì •ì œ</button>
            <button class="btn btn-danger" onclick="confirmReset()">ğŸ§¨ ë°ì´í„° ë¦¬ì…‹</button>
        </section>

        <section class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-label">í˜„ì¬ ì „ì²´ URL</div>
                <span class="stat-value" id="stat-curr-count">--ê°œ</span>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì´ì „ ëŒ€ë¹„ ì¦ê°</div>
                <div class="stat-delta" id="stat-delta">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì˜¤ëŠ˜ ë¶„ì„ ì™„ë£Œ</div>
                <span class="stat-value" id="stat-today-run">--</span>
            </div>
            <div class="stat-card">
                <div class="stat-label">ìµœì¢… ì—…ë°ì´íŠ¸</div>
                <div id="stat-last-time" style="font-size: 0.9rem; font-weight: 700; margin-top:0.5rem">ë¯¸ì‹¤í–‰</div>
            </div>
        </section>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('report')">ğŸ“‹ ì‹¤ì‹œê°„ ë¦¬í¬íŠ¸</div>
            <div class="tab" onclick="switchTab('history')">ğŸ“ˆ íˆìŠ¤í† ë¦¬ ë° í†µê³„</div>
            <div class="tab" onclick="switchTab('all-urls')">ğŸ”— ì „ì²´ URL ëª©ë¡</div>
        </div>

        <div id="tab-report">
            <div id="report-container">
                <p style="text-align:center; color: var(--text-sub); padding: 3rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        </div>

        <div id="tab-history" style="display: none;">
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
            <h3 style="margin-top:2rem">ìµœê·¼ ì¡°ì‚¬ ê²°ê³¼ (ìµœì‹  10ê°œ)</h3>
            <div id="history-table-container"></div>
        </div>

        <div id="tab-all-urls" style="display: none;">
            <div class="stat-card" style="max-height: 500px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tbody id="url-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <h2 style="margin-top: 0;">ğŸ“– ì‚¬ìš© ê°€ì´ë“œ</h2>
            <ol style="padding-left: 1.2rem; line-height: 1.8;">
                <li><strong>ë¶„ì„ ì‹¤í–‰</strong>: ìƒë‹¨ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚¬ì´íŠ¸ë§µì„ ë¶„ì„í•˜ì—¬ ì‹ ê·œ/ìˆ˜ì •ëœ í˜ì´ì§€ë¥¼ ì°¾ìŠµë‹ˆë‹¤.</li>
                <li><strong>ê¸°ì¤€ì </strong>: ì˜¤ëŠ˜ ì²˜ìŒ ì‹¤í–‰í•œ ì‹œì ì˜ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë£¨ ë™ì•ˆì˜ ëª¨ë“  ë³€í™”ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.</li>
                <li><strong>ìƒíƒœê°’ ì•ˆë‚´</strong>:
                    <ul>
                        <li><b style="color:var(--success)">NEW</b>: ìƒˆë¡œ ì¶”ê°€ëœ ë‰´ìŠ¤/ë¸”ë¡œê·¸</li>
                        <li><b style="color:var(--warning)">CHANGED</b>: ë‚´ìš©ì´ ë°”ë€ í˜ì´ì§€</li>
                        <li><b style="color:var(--danger)">DELETED</b>: ì‚¬ë¼ì§„ í˜ì´ì§€</li>
                    </ul>
                </li>
            </ol>
            <button class="btn btn-outline" style="width: 100%; margin-top: 1rem;"
                onclick="toggleModal('help-modal', false)">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        const i18n = {
            ko: {
                title: "Splashtop JP í†µí•© ëª¨ë‹ˆí„°ë§",
                subtitle: "ì‚¬ì´íŠ¸ë§µ ì°¨ë¶„ ì¡°ì‚¬ë¥¼ í†µí•œ ì‹ ì†í•œ ë³€í™” ê°ì§€ ì„œë¹„ìŠ¤",
                help: "â“ ë„ì›€ë§",
                runScan: "ğŸš€ ì‚¬ì´íŠ¸ ë¶„ì„ ì‹¤í–‰ (Run Scan)",
                cleanup: "ğŸ§¹ ë°ì´í„° ì •ì œ",
                reset: "ğŸ§¨ ë°ì´í„° ë¦¬ì…‹",
                statTotal: "í˜„ì¬ ì „ì²´ URL",
                statDelta: "ì´ì „ ëŒ€ë¹„ ì¦ê°",
                statToday: "ì˜¤ëŠ˜ ë¶„ì„ ì™„ë£Œ",
                statLast: "ìµœì¢… ì—…ë°ì´íŠ¸",
                tabReport: "ğŸ“‹ ì‹¤ì‹œê°„ ë¦¬í¬íŠ¸",
                tabHistory: "ğŸ“ˆ íˆìŠ¤í† ë¦¬ ë° í†µê³„",
                tabUrls: "ğŸ”— ì „ì²´ URL ëª©ë¡",
                noChange: "ğŸ‰ ê°ì§€ëœ ìƒˆë¡œìš´ ë³€í™”ê°€ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´íŠ¸ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.",
                loading: "ë¶„ì„ ì¤‘...",
                scaning: "ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.",
                cumTitle: "ğŸ“… ìµœê·¼ 7ì¼ê°„ ëˆ„ì  ë³€í™” ìš”ì•½",
                cumSub: "ê°€ë” ë°©ë¬¸í•˜ì…”ë„ ê´œì°®ìŠµë‹ˆë‹¤! ì§€ë‚œ ì¼ì£¼ì¼ê°„ ì‚¬ì´íŠ¸ì— ìƒˆë¡œ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œëœ ëª¨ë“  í˜ì´ì§€ë¥¼ ëª¨ì•„ì„œ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.",
                newTitle: "[+] ì¼ì£¼ì¼ê°„ ì‹ ê·œ ì¶”ê°€",
                delTitle: "[-] ì¼ì£¼ì¼ê°„ ì‚­ì œ/ì œì™¸",
                historyTitle: "ğŸ“œ ìµœê·¼ ì¡°ì‚¬ ì´ë ¥ (ìµœì‹  30íšŒ)",
                status: "ìƒíƒœ",
                url: "ì£¼ì†Œ",
                desc: "ì„¤ëª…",
                details: "ìƒì„¸",
                view: "ë³´ê¸°",
                webNotice: "ğŸ”” ìë™ ì—…ë°ì´íŠ¸ ëª¨ë“œ: ì›¹ ë²„ì „ì€ ë§¤ì¼ ì•„ì¹¨ 9ì‹œì— ìë™ìœ¼ë¡œ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.",
                helpTitle: "ğŸ“– ì‚¬ìš© ê°€ì´ë“œ",
                helpContent: `1. <b>ë¶„ì„ ì‹¤í–‰</b>: ìƒë‹¨ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚¬ì´íŠ¸ë§µì„ ë¶„ì„í•˜ì—¬ ì‹ ê·œ/ìˆ˜ì •ëœ í˜ì´ì§€ë¥¼ ì°¾ìŠµë‹ˆë‹¤.<br>2. <b>ê¸°ì¤€ì </b>: ì˜¤ëŠ˜ ì²˜ìŒ ì‹¤í–‰í•œ ì‹œì ì˜ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë£¨ ë™ì•ˆì˜ ëª¨ë“  ë³€í™”ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.<br>3. <b>ìƒíƒœê°’ ì•ˆë‚´</b>:<ul><li><b style="color:var(--success)">NEW</b>: ìƒˆë¡œ ì¶”ê°€ëœ ë‰´ìŠ¤/ë¸”ë¡œê·¸</li><li><b style="color:var(--warning)">CHANGED</b>: ë‚´ìš©ì´ ë°”ë€ í˜ì´ì§€</li><li><b style="color:var(--danger)">DELETED</b>: ì‚¬ë¼ì§„ í˜ì´ì§€</li></ul>`,
                reportHeader: "ğŸ” ê°ì§€ëœ ì£¼ìš” ë³€í™”",
                noData: "ì•„ì§ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ìŠ¤ìº”ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.",
                noDesc: "ì„¤ëª… ì—†ìŒ",
                count: "ê±´",
                none: "ì—†ìŒ",
                newDetail: "[ì‹ ê·œ ì¶”ê°€ëœ í˜ì´ì§€]",
                delDetail: "[ì‚­ì œ/ì œì™¸ëœ í˜ì´ì§€]",
                historyHeader: "ğŸ“œ ê°œë³„ ì¡°ì‚¬ ì´ë ¥",
                syncing: "ğŸ“¡ ë°ì´í„° ë™ê¸°í™” ì¤‘...",
                syncSub: "GitHub Actionsê°€ ì²« ë¶„ì„ ê²°ê³¼ë¥¼ ìƒì„± ì¤‘ì´ê±°ë‚˜, ë¸Œë¼ìš°ì €ê°€ íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. 1~2ë¶„ í›„ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”."
            },
            ja: {
                title: "Splashtop JP çµ±åˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°",
                subtitle: "ã‚µã‚¤ãƒˆãƒãƒƒãƒ—å·®åˆ†åˆ†æã«ã‚ˆã‚‹è¿…é€Ÿãªæ›´æ–°æ¤œçŸ¥ã‚µãƒ¼ãƒ“ã‚¹",
                help: "â“ ãƒ˜ãƒ«ãƒ—",
                runScan: "ğŸš€ ã‚µã‚¤ãƒˆåˆ†æå®Ÿè¡Œ (Run Scan)",
                cleanup: "ğŸ§¹ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—",
                reset: "ğŸ§¨ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ",
                statTotal: "ç¾åœ¨å…¨URLæ•°",
                statDelta: "å‰å›æ¯”å¢—æ¸›",
                statToday: "æœ¬æ—¥åˆ†æå®Œäº†",
                statLast: "æœ€çµ‚æ›´æ–°æ—¥",
                tabReport: "ğŸ“‹ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒãƒ¼ãƒˆ",
                tabHistory: "ğŸ“ˆ å±¥æ­´ã¨çµ±è¨ˆ",
                tabUrls: "ğŸ”— å…¨URLãƒªã‚¹ãƒˆ",
                noChange: "ğŸ‰ å‰å›ã®èª¿æŸ»ä»¥é™ã€æ–°ã—ã„å¤‰æ›´ã¯æ¤œçŸ¥ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚µã‚¤ãƒˆã¯å®‰å®šã—ã¦ã„ã¾ã™ã€‚",
                loading: "åˆ†æä¸­...",
                scaning: "ã‚µã‚¤ãƒˆåˆ†æä¸­... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚",
                cumTitle: "ğŸ“… ç›´è¿‘7æ—¥é–“ã®ç´¯ç©å¤‰æ›´è¦ç´„",
                cumSub: "æ™‚ã€…ã®è¨ªå•ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ï¼éå»1é€±é–“ã«ã‚µã‚¤ãƒˆã¸æ–°ãŸã«è¿½åŠ ã¾ãŸã¯å‰Šé™¤ã•ã‚ŒãŸå…¨ãƒšãƒ¼ã‚¸ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ã¾ã™ã€‚",
                newTitle: "[+] 1é€±é–“ä»¥å†…ã®æ–°è¦è¿½åŠ ",
                delTitle: "[-] 1é€±é–“ä»¥å†…ã®å‰Šé™¤/é™¤å¤–",
                historyTitle: "ğŸ“œ æœ€è¿‘ã®èª¿æŸ»å±¥æ­´ (æœ€æ–°30ä»¶)",
                status: "çŠ¶æ…‹",
                url: "ã‚¢ãƒ‰ãƒ¬ã‚¹",
                desc: "èª¬æ˜",
                details: "è©³ç´°",
                view: "è©³ç´°",
                webNotice: "ğŸ”” è‡ªå‹•æ›´æ–°ãƒ¢ãƒ¼ãƒ‰: Webç‰ˆã¯æ¯æ—¥åˆå‰9æ™‚ã«è‡ªå‹•çš„ã«åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚",
                helpTitle: "ğŸ“– åˆ©ç”¨ã‚¬ã‚¤ãƒ‰",
                helpContent: `1. <b>åˆ†æå®Ÿè¡Œ</b>: ä¸Šéƒ¨ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚’åˆ†æã—ã€æ–°è¦/ä¿®æ­£ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‚’æ¢ã—ã¾ã™ã€‚<br>2. <b>åŸºæº–ç‚¹</b>: æœ¬æ—¥æœ€åˆã«å®Ÿè¡Œã—ãŸæ™‚ç‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºæº–ã«ã€1æ—¥é–“ã®ã™ã¹ã¦ã®å¤‰æ›´ã‚’è¿½è·¡ã—ã¾ã™ã€‚<br>3. <b>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¡ˆå†…</b>:<ul><li><b style="color:var(--success)">NEW</b>: æ–°è¦è¿½åŠ ã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ã‚¹/ãƒ–ãƒ­ã‚°</li><li><b style="color:var(--warning)">CHANGED</b>: å†…å®¹ãŒå¤‰æ›´ã•ã‚ŒãŸãƒšãƒ¼ã‚¸</li><li><b style="color:var(--danger)">DELETED</b>: å‰Šé™¤ã•ã‚ŒãŸãƒšãƒ¼ã‚¸</li></ul>`,
                reportHeader: "ğŸ” æ¤œçŸ¥ã•ã‚ŒãŸä¸»ãªå¤‰æ›´",
                noData: "ã¾ã åˆ†æçµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¹ã‚­ãƒ£ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚",
                noDesc: "èª¬æ˜ãªã—",
                count: "ä»¶",
                none: "ãªã—",
                newDetail: "[æ–°è¦è¿½åŠ ã•ã‚ŒãŸãƒšãƒ¼ã‚¸]",
                delDetail: "[å‰Šé™¤/é™¤å¤–ã•ã‚ŒãŸãƒšãƒ¼ã‚¸]",
                historyHeader: "ğŸ“œ å€‹åˆ¥èª¿æŸ»å±¥æ­´",
                syncing: "ğŸ“¡ ãƒ‡ãƒ¼ã‚¿åŒæœŸä¸­...",
                syncSub: "GitHub ActionsãŒæœ€åˆã®åˆ†æçµæœã‚’ç”Ÿæˆä¸­ã‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚1ã€œ2åˆ†å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"
            }
        };

        const lang = navigator.language.startsWith('ja') ? 'ja' : navigator.language.startsWith('ko') ? 'ko' : 'ko';
        const t = i18n[lang];

        let currentData = {};
        let historyChart = null;

        async function init() {
            // UI ë²ˆì—­ ì ìš©
            document.title = t.title;
            const h1 = document.querySelector('.title-group h1');
            if (h1) h1.innerText = t.title;
            const p = document.querySelector('.title-group p');
            if (p) p.innerText = t.subtitle;
            const btnHelp = document.querySelector('.btn-help');
            if (btnHelp) btnHelp.innerText = t.help;
            const btnRun = document.querySelector('.btn-primary');
            if (btnRun) btnRun.innerText = t.runScan;
            const btnClean = document.querySelectorAll('.btn-outline')[0];
            if (btnClean) btnClean.innerText = t.cleanup;
            const btnReset = document.querySelector('.btn-danger');
            if (btnReset) btnReset.innerText = t.reset;
            const statLabels = document.querySelectorAll('.stat-label');
            if (statLabels[0]) statLabels[0].innerText = t.statTotal;
            if (statLabels[1]) statLabels[1].innerText = t.statDelta;
            if (statLabels[2]) statLabels[2].innerText = t.statToday;
            if (statLabels[3]) statLabels[3].innerText = t.statLast;
            const tabs = document.querySelectorAll('.tab');
            if (tabs[0]) tabs[0].innerText = t.tabReport;
            if (tabs[1]) tabs[1].innerText = t.tabHistory;
            if (tabs[2]) tabs[2].innerText = t.tabUrls;
            const loadingP = document.querySelector('#loading-overlay p');
            if (loadingP) loadingP.innerText = t.scaning;
            const modalH2 = document.querySelector('.modal-content h2');
            if (modalH2) modalH2.innerText = t.helpTitle;
            const modalOl = document.querySelector('.modal-content ol');
            if (modalOl) modalOl.innerHTML = t.helpContent;
            const modalBtn = document.querySelectorAll('.modal-content .btn')[0];
            if (modalBtn) modalBtn.innerText = lang === 'ko' ? 'ë‹«ê¸°' : 'é–‰ã˜ã‚‹';

            const isGitHub = window.location.hostname.includes('github.io');
            if (isGitHub) {
                const actionBar = document.querySelector('.action-bar');
                if (actionBar) {
                    actionBar.style.display = 'none';
                    const notice = document.createElement('div');
                    notice.className = 'stat-card';
                    notice.style.borderLeft = '5px solid var(--warning)';
                    notice.style.marginBottom = '2rem';
                    notice.innerHTML = `<b style="color:var(--warning)">${t.webNotice}</b>`;
                    actionBar.parentNode.insertBefore(notice, actionBar);
                }
            }
            await refreshData();
        }

        async function refreshData() {
            try {
                // í˜„ì¬ í˜ì´ì§€ì˜ ê²½ë¡œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì • (GitHub Pages ëŒ€ì‘)
                const baseUrl = window.location.pathname.endsWith('/') ? window.location.pathname : window.location.pathname + '/';
                const ts = new Date().getTime();

                const fetchJson = async (file) => {
                    const r = await fetch(`./${file}?t=${ts}`);
                    if (!r.ok) throw new Error(`Failed to load ${file}`);
                    return await r.json();
                };

                // ë°ì´í„° ë¡œë”©
                const data = {
                    meta: await fetchJson('site_report_meta.json'),
                    summary: await fetchJson('site_summary.json'),
                    structure: await fetchJson('site_structure.json'),
                    history: await fetchJson('monitoring_history.json')
                };

                currentData = data;
                renderStats(data.meta);
                renderReport(data.summary);
                renderAllUrls(data.structure);
                renderHistory(data.history);
            } catch (e) {
                console.error("Data fetch failed", e);
                // ì¢€ ë” ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€
                document.getElementById('report-container').innerHTML =
                    `<div class="stat-card" style="text-align:center; padding:3rem;">
                        <p style="font-size:1.2rem; font-weight:700;">${t.syncing}</p>
                        <p style="color:var(--text-sub);">${t.syncSub}</p>
                    </div>`;
            }
        }

        function renderStats(meta) {
            if (!meta) return;
            document.getElementById('stat-curr-count').innerText = (meta.curr_count || 0) + t.count;
            const delta = (meta.curr_count || 0) - (meta.prev_count || 0);
            const deltaEl = document.getElementById('stat-delta');
            deltaEl.innerText = (delta >= 0 ? '+' : '') + delta + t.count;
            deltaEl.className = 'stat-delta ' + (delta >= 0 ? 'delta-plus' : 'delta-minus');

            const lastTime = meta.curr_time || "";
            document.getElementById('stat-last-time').innerText = lastTime.replace('T', ' ').substring(0, 16);

            const isToday = lastTime.startsWith(new Date().toISOString().split('T')[0]);
            document.getElementById('stat-today-run').innerText = isToday ? (lang === 'ko' ? "ì™„ë£Œ" : "å®Œäº†") : (lang === 'ko' ? "ë¯¸ì‹¤í–‰" : "æœªå®Ÿè¡Œ");
        }

        function renderReport(summary) {
            const container = document.getElementById('report-container');
            if (!summary || summary.length === 0) {
                container.innerHTML = `<p style="text-align:center; padding: 2rem;">${t.noData}</p>`;
                return;
            }

            const interesting = summary.filter(s => ['new', 'changed', 'deleted', 'error'].includes(s.status));
            if (interesting.length === 0) {
                container.innerHTML = `<div class="stat-card" style="text-align: center; color: var(--success); font-weight: 700;">${t.noChange}</div>`;
                return;
            }

            let html = `<h3>${t.reportHeader} (${interesting.length}${t.count})</h3>`;
            interesting.forEach(item => {
                const title = (item.title === 'No Title' || !item.title) ? item.url.split('/').pop() : item.title;
                html += `
                <div class="report-item">
                    <div class="item-header" onclick="toggleItem(this)">
                        <span class="badge badge-${item.status}">${item.status.toUpperCase()}</span>
                        <span class="item-title">${title}</span>
                    </div>
                    <div class="item-content">
                        <a href="${item.url}" target="_blank" class="url-link">${item.url}</a>
                        <p class="item-desc">${item.description || t.noDesc}</p>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function toggleItem(el) {
            const content = el.nextElementSibling;
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }

        function renderAllUrls(struct) {
            const body = document.getElementById('url-list-body');
            let html = '';
            Object.keys(struct || {}).sort().forEach(url => {
                html += `<tr><td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.85rem;"><a href="${url}" target="_blank" style="color:inherit; text-decoration:none;">${url}</a></td></tr>`;
            });
            body.innerHTML = html;
        }

        function renderHistory(history) {
            if (!history || history.length === 0) return;

            const labels = history.map(h => h.timestamp.split('T')[0]);
            const values = history.map(h => h.total_count);

            if (historyChart) historyChart.destroy();
            const ctx = document.getElementById('historyChart').getContext('2d');
            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: lang === 'ko' ? 'ì „ì²´ URL ìˆ˜' : 'å…¨URLæ•°',
                        data: values,
                        borderColor: '#0055ff',
                        backgroundColor: 'rgba(0, 85, 255, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Cumulative Summary (Last 7 Days)
            const now = new Date();
            const last7Days = new Date(now.getTime() - (7 * 24 * 60 * 60 * 1000));

            let cumulativeNew = new Set();
            let cumulativeDel = new Set();

            history.forEach(h => {
                const hDate = new Date(h.timestamp);
                if (hDate >= last7Days) {
                    (h.new_details || []).forEach(u => cumulativeNew.add(u));
                    (h.deleted_details || []).forEach(u => cumulativeDel.add(u));
                }
            });

            let cumuHtml = `
            <div class="stat-card" style="border-left: 5px solid var(--primary); margin: 2rem 0; background: #f0f7ff;">
                <h4 style="margin:0 0 0.5rem 0;">${t.cumTitle}</h4>
                <p style="font-size:0.85rem; color:var(--text-sub); margin-bottom:1rem;">${t.cumSub}</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <b style="color:var(--success)">${t.newTitle} (${cumulativeNew.size}${t.count})</b>
                        <ul style="font-size:0.8rem; margin-top:0.5rem; max-height:180px; overflow-y:auto; padding-left:1.2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
                            ${Array.from(cumulativeNew).map(u => `<li style="margin-bottom:4px"><a href="${u}" target="_blank" style="color:inherit;">${u.split('/').pop() || u}</a></li>`).join('') || `<li style="color:#aaa; padding:10px;">${t.none}</li>`}
                        </ul>
                    </div>
                    <div>
                        <b style="color:var(--danger)">${t.delTitle} (${cumulativeDel.size}${t.count})</b>
                        <ul style="font-size:0.8rem; margin-top:0.5rem; max-height:180px; overflow-y:auto; padding-left:1.2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
                            ${Array.from(cumulativeDel).map(u => `<li style="margin-bottom:4px">${u.split('/').pop() || u}</li>`).join('') || `<li style="color:#aaa; padding:10px;">${t.none}</li>`}
                        </ul>
                    </div>
                </div>
            </div>`;

            // Table (Show only latest 30 entries for UI performance)
            let tableHtml = cumuHtml + `<h3 style="margin-top:2.5rem">${t.historyTitle}</h3><table style="width:100%; border-collapse: collapse; margin-top:1rem; text-align:left; border: 1px solid var(--border); transition: all 0.3s;">`;
            tableHtml += `<thead style="background:#f1f5f9"><tr><th style="padding:0.7rem">${lang === 'ko' ? 'ë‚ ì§œ/ì‹œê°„' : 'æ—¥æ™‚'}</th><th>${lang === 'ko' ? 'ì „ì²´' : 'åˆè¨ˆ'}</th><th>${lang === 'ko' ? 'ì‹ ê·œ' : 'æ–°è¦'}</th><th>${lang === 'ko' ? 'ì‚­ì œ' : 'å‰Šé™¤'}</th><th>${t.details}</th></tr></thead><tbody>`;

            const tableData = history.slice().reverse().slice(0, 30);
            tableData.forEach((h, idx) => {
                const rowId = `history-row-${idx}`;
                const hasDetails = (h.new_count > 0 || h.deleted_count > 0);

                tableHtml += `
                <tr style="border-bottom:1px solid var(--border)">
                    <td style="padding:0.6rem; color:var(--text-sub); font-size:0.85rem">${h.timestamp.replace('T', ' ').substring(0, 16)}</td>
                    <td><b>${h.total_count}</b></td>
                    <td style="color:var(--success)">+${h.new_count}</td>
                    <td style="color:var(--danger)">-${h.deleted_count}</td>
                    <td>${hasDetails ? `<button class="btn-help" style="padding: 0.2rem 0.5rem; font-size: 0.75rem;" onclick="toggleHistoryDetails('${rowId}')">${t.view}</button>` : '-'}</td>
                </tr>
                <tr id="${rowId}" style="display:none; background: #fdfdfd; border-bottom: 1px solid var(--border);">
                    <td colspan="5" style="padding: 1rem; font-size: 0.85rem;">
                        ${h.new_count > 0 ? `
                            <div style="margin-bottom:0.5rem"><b style="color:var(--success)">${t.newDetail}</b></div>
                            <ul style="margin: 0 0 1rem 0; padding-left: 1.2rem; color: var(--text-sub);">
                                ${h.new_details.map(url => `<li><a href="${url}" target="_blank" style="color:inherit;">${url}</a></li>`).join('')}
                            </ul>
                        ` : ''}
                        ${h.deleted_count > 0 ? `
                            <div><b style="color:var(--danger)">${t.delDetail}</b></div>
                            <ul style="margin: 0; padding-left: 1.2rem; color: var(--text-sub);">
                                ${h.deleted_details.map(url => `<li>${url}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </td>
                </tr>`;
            });
            tableHtml += '</tbody></table>';
            document.getElementById('history-table-container').innerHTML = tableHtml;
        }

        function toggleHistoryDetails(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'table-row' ? 'none' : 'table-row';
        }

        async function runScan() {
            document.getElementById('loading-overlay').style.display = 'flex';
            try {
                const res = await fetch('/api/scan', { method: 'POST' });
                if (res.ok) await refreshData();
            } finally {
                document.getElementById('loading-overlay').style.display = 'none';
            }
        }

        async function runCleanup() {
            if (!confirm("ë°ì´í„° ì •ì œë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const res = await fetch('/api/cleanup', { method: 'POST' });
            if (res.ok) { alert("ë°ì´í„° ì •ì œ ì™„ë£Œ"); await refreshData(); }
        }

        async function confirmReset() {
            if (!confirm("âš ï¸ ì£¼ì˜: ëª¨ë“  ëª¨ë‹ˆí„°ë§ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const res = await fetch('/api/reset', { method: 'POST' });
            if (res.ok) { window.location.reload(); }
        }

        function switchTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-report').style.display = name === 'report' ? 'block' : 'none';
            document.getElementById('tab-history').style.display = name === 'history' ? 'block' : 'none';
            document.getElementById('tab-all-urls').style.display = name === 'all-urls' ? 'block' : 'none';
        }

        function toggleModal(id, show) {
            document.getElementById(id).style.display = show ? 'flex' : 'none';
        }

        init();
    </script>
</body>

</html>